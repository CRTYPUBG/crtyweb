Add-Type -AssemblyName PresentationFramework

# Pencere oluÅŸtur
[xml]$xaml = @"
<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        Title="CRTY GameLoop FPS Optimizer" Height="300" Width="400" WindowStartupLocation="CenterScreen" ResizeMode="NoResize" Background="#222222" >
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="CRTY GameLoop FPS Optimize AracÄ±" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,10"/>

        <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center" Width="300" Spacing="10">
            <Button Name="btnOptimize" Content="âš¡ Optimize Et (FPS ArtÄ±r & Anti-Lag)" Height="40" FontSize="14" Background="#007ACC" Foreground="White" />
            <Button Name="btnUndo" Content="â†© AyarlarÄ± Geri Al" Height="40" FontSize="14" Background="#555555" Foreground="White" />
        </StackPanel>

        <TextBlock Name="statusText" Grid.Row="2" Text="Durum: HazÄ±r." FontSize="14" Foreground="LightGreen" HorizontalAlignment="Center" Margin="0,15,0,0"/>
    </Grid>
</Window>
"@

# XAML'Ä± yÃ¼kle
$reader = (New-Object System.Xml.XmlNodeReader $xaml)
$window = [Windows.Markup.XamlReader]::Load($reader)

# Kontrolleri yakala
$btnOptimize = $window.FindName("btnOptimize")
$btnUndo = $window.FindName("btnUndo")
$statusText = $window.FindName("statusText")

# Optimize Et butonu tÄ±klama olayÄ±
$btnOptimize.Add_Click({
    try {
        $statusText.Text = "Durum: GeliÅŸmiÅŸ optimizasyon baÅŸlÄ±yor..."

        # Game DVR kapat
        reg add "HKCU\System\GameConfigStore" /v GameDVR_Enabled /t REG_DWORD /d 0 /f | Out-Null
        reg add "HKCU\System\GameConfigStore" /v GameDVR_FSEBehavior /t REG_DWORD /d 0 /f | Out-Null

        # Xbox Game Bar kapat
        reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\GameDVR" /v AppCaptureEnabled /t REG_DWORD /d 0 /f | Out-Null
        reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\GameDVR" /v AudioCaptureEnabled /t REG_DWORD /d 0 /f | Out-Null

        # Xbox ve Gaming GÃ¶revlerini Kapat (Schedule Task)
        Get-ScheduledTask | Where-Object { $_.TaskName -like "*Xbox*" -or $_.TaskName -like "*Gaming*" } | ForEach-Object { Disable-ScheduledTask -TaskName $_.TaskName -TaskPath $_.TaskPath }

        # GÃ¼Ã§ planÄ±nÄ± YÃ¼ksek Performansa al
        powercfg /setactive SCHEME_MIN

        # CPU throttle ayarlarÄ± (maksimum performans)
        powercfg /setacvalueindex SCHEME_MIN SUB_PROCESSOR PROCTHROTTLEMIN 100
        powercfg /setacvalueindex SCHEME_MIN SUB_PROCESSOR PROCTHROTTLEMAX 100
        powercfg /setactive SCHEME_MIN

        # Superfetch (SysMain) servisini kapat
        Stop-Service SysMain -ErrorAction SilentlyContinue
        Set-Service SysMain -StartupType Disabled

        # TCP autotuning kapat (lag azaltmak iÃ§in)
        netsh interface tcp set global autotuninglevel=disabled | Out-Null

        # GameLoop Ã¶nceliÄŸini yÃ¼ksek yap (varsa)
        $gameLoop = Get-Process -Name "GameLoop" -ErrorAction SilentlyContinue
        if ($gameLoop) {
            $gameLoop | ForEach-Object { $_.PriorityClass = "High" }
        }

        # Sanal bellek elle ayarla (16GB RAM iÃ§in Ã¶rnek)
        $minPageFile = 16384
        $maxPageFile = 32768
        $computer = Get-WmiObject -Class Win32_ComputerSystem
        $computer.AutomaticManagedPagefile = $false
        $pagefile = Get-WmiObject -Query "SELECT * FROM Win32_PageFileSetting WHERE Name LIKE 'C:\\pagefile.sys'"
        if ($pagefile) {
            $pagefile.InitialSize = $minPageFile
            $pagefile.MaximumSize = $maxPageFile
            $pagefile.Put() | Out-Null
        }

        Start-Sleep -Seconds 3
        $statusText.Text = "Durum: Optimizasyon tamamlandÄ±! ðŸŽ®ðŸš€"
    }
    catch {
        $statusText.Text = "Hata: $_"
    }
})

# Geri Al butonu tÄ±klama olayÄ±
$btnUndo.Add_Click({
    try {
        $statusText.Text = "Durum: Ayarlar geri alÄ±nÄ±yor..."

        # Game DVR aÃ§
        reg add "HKCU\System\GameConfigStore" /v GameDVR_Enabled /t REG_DWORD /d 1 /f | Out-Null
        reg add "HKCU\System\GameConfigStore" /v GameDVR_FSEBehavior /t REG_DWORD /d 1 /f | Out-Null

        # Xbox Game Bar aÃ§
        reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\GameDVR" /v AppCaptureEnabled /t REG_DWORD /d 1 /f | Out-Null
        reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\GameDVR" /v AudioCaptureEnabled /t REG_DWORD /d 1 /f | Out-Null

        # Schedule Task yeniden aÃ§
        Get-ScheduledTask | Where-Object { $_.TaskName -like "*Xbox*" -or $_.TaskName -like "*Gaming*" } | ForEach-Object { Enable-ScheduledTask -TaskName $_.TaskName -TaskPath $_.TaskPath }

        # GÃ¼Ã§ planÄ±nÄ± Dengeye al
        powercfg /setactive SCHEME_BALANCED

        # SysMain servisini aÃ§
        Set-Service SysMain -StartupType Automatic
        Start-Service SysMain

        # TCP autotuning aÃ§
        netsh interface tcp set global autotuninglevel=normal | Out-Null

        # Sanal bellek otomatik yÃ¶netim
        $computer = Get-WmiObject -Class Win32_ComputerSystem
        $computer.AutomaticManagedPagefile = $true

        Start-Sleep -Seconds 3
        $statusText.Text = "Durum: Ayarlar geri alÄ±ndÄ±."
    }
    catch {
        $statusText.Text = "Hata: $_"
    }
})

# Pencereyi aÃ§
$window.ShowDialog() | Out-Null
